<div class="dashboard-container fade-in">
  <!-- Loader -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="mt-3 text-muted">Chargement des statistiques...</p>
  </div>

  <!-- Erreur -->
  <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
  </div>

  <!-- Contenu principal -->
  <div *ngIf="!loading && !error">
    <!-- Header -->
    <div class="dashboard-header mb-4">
      <h2 class="fw-bold">
        <i class="fas fa-tachometer-alt me-2"></i>Tableau de Bord Administrateur
      </h2>
      <p class="text-muted">Vue d'ensemble du système d'archivage</p>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-4">
      <!-- Total Documents -->
      <div class="col-md-3">
        <div class="stat-card modern-card">
          <div class="stat-icon bg-primary">
            <i class="fas fa-file-alt"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-number">{{ stats.totalDocuments }}</h3>
            <p class="stat-label">Documents</p>
          </div>
        </div>
      </div>

      <!-- Total Users -->
      <div class="col-md-3">
        <div class="stat-card modern-card">
          <div class="stat-icon bg-success">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-number">{{ stats.totalUsers }}</h3>
            <p class="stat-label">Utilisateurs</p>
          </div>
        </div>
      </div>

      <!-- Total Departments -->
      <div class="col-md-3">
        <div class="stat-card modern-card">
          <div class="stat-icon bg-warning">
            <i class="fas fa-building"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-number">{{ stats.totalDepartments }}</h3>
            <p class="stat-label">Départements</p>
          </div>
        </div>
      </div>

      <!-- Storage Used -->
      <div class="col-md-3">
        <div class="stat-card modern-card">
          <div class="stat-icon bg-info">
            <i class="fas fa-database"></i>
          </div>
          <div class="stat-info">
            <h3 class="stat-number">{{ stats.storageUsed }} GB</h3>
            <p class="stat-label">Stockage</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Graphiques -->
    <div class="row g-4 mb-4">
      <!-- Documents par Département -->
      <div class="col-md-6">
        <div class="modern-card p-4">
          <h5 class="mb-3 fw-bold">
            <i class="fas fa-building me-2"></i>Documents par Département
          </h5>
          <div *ngIf="documentsParDepartement.length > 0">
            <div *ngFor="let dept of documentsParDepartement" class="mb-3">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <span class="fw-medium">{{ dept.nom_departement }}</span>
                <span class="badge bg-primary">{{ dept.total }}</span>
              </div>
              <div class="progress" style="height: 8px;">
                <div class="progress-bar bg-primary"
                     [style.width.%]="(dept.total / stats.totalDocuments) * 100">
                </div>
              </div>
            </div>
          </div>
          <p *ngIf="documentsParDepartement.length === 0" class="text-muted text-center">
            Aucune donnée disponible
          </p>
        </div>
      </div>

      <!-- Documents par Type -->
      <div class="col-md-6">
        <div class="modern-card p-4">
          <h5 class="mb-3 fw-bold">
            <i class="fas fa-file me-2"></i>Documents par Type
          </h5>
          <div *ngIf="documentsParType.length > 0">
            <div *ngFor="let type of documentsParType" class="mb-3">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <span class="fw-medium">{{ type.libelle_type }}</span>
                <span class="badge bg-success">{{ type.total }}</span>
              </div>
              <div class="progress" style="height: 8px;">
                <div class="progress-bar bg-success"
                     [style.width.%]="(type.total / stats.totalDocuments) * 100">
                </div>
              </div>
            </div>
          </div>
          <p *ngIf="documentsParType.length === 0" class="text-muted text-center">
            Aucune donnée disponible
          </p>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="row g-4 mb-4">
      <div class="col-md-12">
        <div class="modern-card p-4">
          <h4 class="mb-3 fw-bold">
            <i class="fas fa-bolt me-2"></i>Actions Rapides
          </h4>
          <div class="quick-actions">
            <button class="btn btn-outline-primary" routerLink="/admin/users">
              <i class="fas fa-user-plus me-2"></i>Nouvel Utilisateur
            </button>
            <button class="btn btn-outline-success" routerLink="/admin/departements">
              <i class="fas fa-building me-2"></i>Nouveau Département
            </button>
            <button class="btn btn-outline-info" routerLink="/admin/documents">
              <i class="fas fa-file-upload me-2"></i>Importer Documents
            </button>
            <button class="btn btn-outline-warning" routerLink="/admin/statistiques">
              <i class="fas fa-chart-bar me-2"></i>Voir Statistiques
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="row g-4">
      <div class="col-md-12">
        <div class="modern-card p-4">
          <h4 class="mb-3 fw-bold">
            <i class="fas fa-history me-2"></i>Activité Récente
          </h4>
          <div class="activity-list" *ngIf="activiteRecente.length > 0">
            <div *ngFor="let action of activiteRecente" class="activity-item">
              <i class="fas" [ngClass]="getActionIcon(action.type_action)"></i>
              <div class="activity-content">
                <strong>{{ getActionLabel(action.type_action) }}</strong>
                <p class="text-muted mb-0">
                  {{ action.document?.titre || 'Document inconnu' }}
                  par {{ action.user?.nom_complet || 'Utilisateur inconnu' }}
                  - {{ formatDate(action.created_at) }}
                </p>
              </div>
            </div>
          </div>
          <p *ngIf="activiteRecente.length === 0" class="text-muted text-center">
            Aucune activité récente
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
